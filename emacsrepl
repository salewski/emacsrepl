#!/bin/sh
# emacsrepl - Interactive CLI REPL for Emacs Lisp

trap 'stty "$restore"' EXIT

restore=$(stty -g)
stty raw -echo opost

script=${0%/*}/emacsrepl.el

repl() {
    emacs -Q --batch --load "$script"
    pkill -u "$USER" -P "$$" -x od
}

stdbuf -oL od -w1 -An -tx1 -v | sed -u -e 's/^ //' | repl
